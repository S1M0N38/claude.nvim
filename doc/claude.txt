================================================================================
INTRODUCTION                                                           *claude*

claude.nvim integrates Claude Code into Neovim via a floating terminal. It
provides commands to toggle the terminal, send visual selections, and send
file references to Claude Code. Notifications from Claude Code hooks are
forwarded to Neovim's `vim.notify()`.

Links:
- Repository: https://github.com/S1M0N38/claude.nvim
- License (MIT): https://github.com/S1M0N38/claude.nvim/blob/main/LICENSE

Table of contents:

1. REQUIREMENTS: Plugin dependencies and setup.           |claude-requirements|
2. INSTALLATION: How to install and configure.            |claude-installation|
3. CONFIGURATION: Available options and their defaults.         |claude-config|
4. COMMANDS: Commands provided by the plugin.                 |claude-commands|
5. KEYMAPS: Default keymaps and terminal-mode behavior.        |claude-keymaps|
6. FILE EXPLORER: Browse and send file references.           |claude-explorer|
7. HOOKS: Notification forwarding from Claude Code.              |claude-hooks|
8. API: Lua functions exposed by the plugin.                       |claude-api|
9. TROUBLESHOOTING: Common issues and solutions.       |claude-troubleshooting|

================================================================================
REQUIREMENTS                                              *claude-requirements*

- Neovim >= 0.11
- Claude Code CLI: https://docs.anthropic.com/en/docs/claude-code
- jq (optional): required for notification hooks (`scripts/nvim-notify.sh`)
- mini.files (optional): required for file explorer feature
- snacks.nvim (optional): required for file picker feature

================================================================================
INSTALLATION                                              *claude-installation*

Install using lazy.nvim (https://github.com/folke/lazy.nvim):

>lua
  {
    "S1M0N38/claude.nvim",
    version = "*",
    event = "VeryLazy",
    opts = {},
  }
<

With custom options:

>lua
  {
    "S1M0N38/claude.nvim",
    version = "*",
    event = "VeryLazy",
    opts = {
      cmd = "claude",
      float = {
        width = 0.9,
        height = 0.9,
        border = "single",
      },
    },
  }
<

Using rocks.nvim (https://github.com/nvim-neorocks/rocks.nvim):

>vim
  :Rocks install claude.nvim
<

================================================================================
CONFIGURATION                                                   *claude-config*

                                                             *claude.setup()*
claude.setup({opts}) ~

  The `setup()` function configures the plugin with user options. Options are
  merged with defaults using `vim.tbl_deep_extend`.

Default options: ~

>lua
  {
    cmd = "claude",          -- Command used to launch Claude Code
    float = {
      width = 0.8,          -- Width as fraction of editor (0.0 - 1.0)
      height = 0.8,         -- Height as fraction of editor (0.0 - 1.0)
      border = "rounded",   -- Border style (see :help nvim_open_win)
    },
    keymaps = {
      enabled = true,       -- Whether to set default keymaps
      toggle = "<C-.>",     -- Keymap for toggling the terminal
      picker = "<C-f>",     -- Keymap for file picker (requires snacks.nvim)
      explorer = "<C-e>",   -- Keymap for file explorer (requires mini.files)
    },
  }
<

                                                          *claude-config-cmd*
cmd ~
  The shell command used to launch Claude Code in the terminal. The plugin
  prepends `NVIM_SERVER=<servername>` to enable notification hooks.

                                                        *claude-config-float*
float ~
  Controls the floating window dimensions and appearance. Width and height are
  fractions of the editor size. Border can be any value accepted by
  |nvim_open_win()| (e.g. "none", "single", "double", "rounded", "solid").

                                                      *claude-config-keymaps*
keymaps ~
  When `keymaps.enabled` is true, the plugin sets:
  - `<C-.>` (normal mode) to toggle the floating terminal
  - `<C-.>` (terminal mode, inside the Claude buffer) to toggle the terminal
  - `<Esc><Esc>` (terminal mode, inside the Claude buffer) to exit terminal
    mode (see |claude-keymaps|)

  Set `keymaps.enabled = false` to disable all default keymaps and define
  your own using the |claude-api|.

================================================================================
COMMANDS                                                      *claude-commands*

                                                              *:ClaudeToggle*
:ClaudeToggle ~
  Toggle the Claude Code floating terminal. If the terminal is not yet
  running, a new Claude Code process is spawned. If the window is open, it
  is closed (the process keeps running in the background). If the window is
  closed, it is reopened with the same session.

                                                                *:ClaudeSend*
:'<,'>ClaudeSend ~
  Send the visual selection to the Claude terminal. The selected text is
  sent verbatim followed by a newline. If the terminal window is closed,
  it is reopened after sending. The terminal must be running.

  Usage: select text in visual mode, then run `:ClaudeSend`.

                                                             *:ClaudeSendRef*
:'<,'>ClaudeSendRef ~
  Send a file reference with line range to the Claude terminal. The reference
  uses the `@path#L1-5` format that Claude Code understands. If the terminal
  window is closed, it is reopened after sending.

  Example output: ` @lua/claude/init.lua#L10-15 `

  Usage: select a range in visual mode, then run `:ClaudeSendRef`.

================================================================================
KEYMAPS                                                        *claude-keymaps*

When `keymaps.enabled` is true (the default), the following keymaps are set:

Normal mode: ~

  `<C-.>`      Toggle the Claude floating terminal     |:ClaudeToggle|
  `<C-f>`      Open file picker                        |:ClaudeExplorer|
  `<C-e>`      Open file explorer                      |:ClaudeExplorer|

Terminal mode (Claude buffer only): ~

  `<C-.>`      Toggle the Claude floating terminal     |:ClaudeToggle|
  `<Esc><Esc>` Exit terminal mode (return to normal mode)

Single Escape behavior: ~

  Inside the Claude terminal, a single `<Esc>` is forwarded to Claude Code
  (which uses it for its own UI). To exit terminal mode, press `<Esc>` twice
  within 200ms. If only one `<Esc>` is pressed, the keypress is sent to
  Claude Code after the timeout.

Filetype: ~

  The terminal buffer has filetype `claude`. You can use this for
  filetype-specific autocommands:

>lua
  vim.api.nvim_create_autocmd("FileType", {
    pattern = "claude",
    callback = function()
      -- your custom setup for the Claude buffer
    end,
  })
<

================================================================================
FILE EXPLORER                                                  *claude-explorer*

claude.nvim provides two ways to browse files and send references to Claude.

                                                             *:ClaudeExplorer*
:ClaudeExplorer ~
  Open a file explorer to browse and select files. The selected file path is
  sent as a reference (@path format) to the Claude terminal. This command
  requires mini.files and opens an interactive file browser.

                                                                *:ClaudePicker*
:ClaudePicker ~
  Open a file picker to search and select files. This command requires
  snacks.nvim and provides a searchable file picker interface. The selected
  file path is sent as a reference (@path format) to the Claude terminal.

Default keymaps: ~

  Normal mode:
    `<C-e>`      Open file explorer (explorer feature)
    `<C-f>`      Open file picker (picker feature)

Dependencies: ~

  - File Explorer (`<C-e>`): requires mini.files
  - File Picker (`<C-f>`): requires snacks.nvim

If the required dependency is not available, attempting to use the feature
will show a warning notification. The terminal must be running before using
either feature.

================================================================================
HOOKS                                                            *claude-hooks*

claude.nvim can forward notifications from Claude Code to Neovim's
`vim.notify()`. This lets you receive alerts when Claude Code needs attention
(permission prompts, idle prompts) or completes a task, even when the
terminal window is closed or you're in another buffer.

Setup: ~

  Configure Claude Code's hook system to call `scripts/nvim-notify.sh`.
  Add the following to your Claude Code settings file
  (`~/.claude/settings.json`):

>json
  {
    "hooks": {
      "Notification": [
        {
          "matcher": "*",
          "hooks": [
            {
              "type": "command",
              "command": "/path/to/claude.nvim/scripts/nvim-notify.sh"
            }
          ]
        }
      ],
      "Stop": [
        {
          "hooks": [
            {
              "type": "command",
              "command": "/path/to/claude.nvim/scripts/nvim-notify.sh"
            }
          ]
        }
      ]
    }
  }
<

  Replace `/path/to/claude.nvim` with the actual install path.

  If you use lazy.nvim, you can find the path with:

>lua
  :lua print(require("lazy.core.config").plugins["claude.nvim"].dir)
<

How it works: ~

  1. When the floating terminal opens, `NVIM_SERVER` is set to Neovim's
     RPC socket path (`vim.v.servername`).
  2. Claude Code triggers `Notification` or `Stop` hook events.
  3. `nvim-notify.sh` reads JSON from stdin, extracts relevant fields using
     `jq`, writes them to a temp file, and calls back into Neovim via
     `nvim --server $NVIM_SERVER --remote-expr`.
  4. The Lua function `require("claude.notify").from_hook()` reads the temp
     file, decodes the JSON, and calls `vim.notify()`.

Notification types and levels: ~

  `permission_prompt`     WARN     Claude needs permission to proceed
  `idle_prompt`           WARN     Claude is waiting for input
  `auth_success`          INFO     Authentication succeeded
  `elicitation_dialog`    WARN     Claude is showing a dialog
  `Stop` event            INFO     Task completed

Requirements: ~

  - `jq` must be installed and in `$PATH`
  - Neovim must have a server socket (check with `:echo v:servername`)
  - The hook script must be executable (`chmod +x scripts/nvim-notify.sh`)

================================================================================
API                                                                *claude-api*

The plugin exposes its API through `require("claude")`:

                                                         *claude.setup()-api*
claude.setup({opts}) ~
  Configure the plugin. See |claude-config| for available options.

>lua
  require("claude").setup({
    cmd = "claude",
    float = { width = 0.9, border = "single" },
    keymaps = { toggle = "<leader>cc" },
  })
<

                                                            *claude.toggle()*
claude.toggle() ~
  Toggle the Claude floating terminal. Same as |:ClaudeToggle|.

>lua
  require("claude").toggle()
<

                                                    *claude.send_selection()*
claude.send_selection({opts}) ~
  Send the visual selection text to the Claude terminal.
  Accepts an optional table with `range`, `line1`, `line2` fields
  (as provided by Neovim command callbacks).

>lua
  require("claude").send_selection()
<

                                                    *claude.send_reference()*
claude.send_reference() ~
  Send a file reference with line range (`@path#L1-5` format) to the
  Claude terminal.

>lua
  require("claude").send_reference()
<

                                                        *claude.browse_files()*
claude.browse_files() ~
  Open the file explorer using mini.files to browse and send file references.
  Requires mini.files to be available.

>lua
  require("claude.explorer").browse_files()
<

                                                        *claude.pick_files()*
claude.pick_files() ~
  Open the file picker using snacks.nvim to search and send file references.
  Requires snacks.nvim to be available.

>lua
  require("claude.picker").pick_files()
<

Custom keymap examples: ~

  If you set `keymaps.enabled = false`, you can define your own bindings:

>lua
  require("claude").setup({ keymaps = { enabled = false } })

  vim.keymap.set("n", "<leader>cc", function()
    require("claude").toggle()
  end, { desc = "Toggle Claude terminal" })

  vim.keymap.set("v", "<leader>cs", function()
    require("claude").send_selection()
  end, { desc = "Send selection to Claude" })

  vim.keymap.set("v", "<leader>cr", function()
    require("claude").send_reference()
  end, { desc = "Send file reference to Claude" })

  vim.keymap.set("n", "<leader>ce", function()
    require("claude.explorer").browse_files()
  end, { desc = "Browse files with explorer" })

  vim.keymap.set("n", "<leader>cf", function()
    require("claude.picker").pick_files()
  end, { desc = "Pick files with picker" })
<

================================================================================
TROUBLESHOOTING                                        *claude-troubleshooting*

Run the health check to identify issues:
>vim
  :checkhealth claude
<

The health check validates:
- Neovim version (>= 0.11)
- Claude Code CLI is executable
- Configuration options are valid
- `jq` is available (for notification hooks)
- Neovim server socket is available (for notification hooks)

Terminal does not open: ~

  Ensure `claude` (or your configured `cmd`) is installed and in your `$PATH`.
  Run `:checkhealth claude` to verify.

Notifications are not working: ~

  1. Verify `jq` is installed: `jq --version`
  2. Check the Neovim server socket: `:echo v:servername`
  3. Ensure the hook script path in `~/.claude/settings.json` is correct
  4. Ensure the script is executable: `chmod +x scripts/nvim-notify.sh`

Escape key not working as expected: ~

  Inside the Claude terminal, single `<Esc>` is forwarded to Claude Code
  after a 200ms timeout. Press `<Esc>` twice quickly to exit terminal mode.
  See |claude-keymaps| for details.

Terminal process keeps running: ~

  This is by design. Closing the floating window (`:ClaudeToggle` or `<C-.>`)
  only hides the window. The Claude Code process continues in the background.
  Reopening the terminal restores the same session. The process is cleaned up
  when the terminal buffer is deleted or when you quit Neovim.

================================================================================
vim:tw=78:ts=8:et:ft=help:norl:
